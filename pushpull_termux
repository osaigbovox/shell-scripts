#!/usr/bin/env bash
# pushpull_termux â€” Push/Pull between Termux and Mac via scp

set -euo pipefail

usage() {
  cat <<EOF
Usage: pushpull_termux <push|pull> <mac|mac2> <source> [destination]

Modes:
  push   Send local Termux <source> to Mac
  pull   Fetch remote <source> from Mac to Termux

Hosts:
  mac    â†’ first Mac host (alias in ~/.ssh/config)
  mac2   â†’ second Mac host

<source>:
  push   â†’ Termux path (e.g. ~/storage/shared/music)
  pull   â†’ Mac path (e.g. ~/Downloads/project)

[destination] (optional):
  push   â†’ remote Mac destination (default: ~/Downloads/)
  pull   â†’ local Termux destination (default: ~/storage/downloads/)

Examples:
  # Pull a file from Mac to Termux:
  pushpull_termux pull mac ~/Downloads/notes.txt ~/storage/downloads/

  # Push a directory from Termux to Mac2:
  pushpull_termux push mac2 ~/storage/shared/images ~/Pictures/Imported
EOF
  exit 1
}

if (( $# < 3 )); then
  usage
fi

mode="$1";      shift
host="$1";      shift
src="$1";       shift
dest="${1:-}"

if [[ "$mode" != "push" && "$mode" != "pull" ]]; then
  echo "âŒ Invalid mode: $mode"; usage
fi

if [[ "$host" != "mac" && "$host" != "mac2" ]]; then
  echo "âŒ Invalid host: $host"; usage
fi

if [[ "$mode" == "push" ]]; then
  # Termux â†’ Mac
  if [[ ! -e "$src" ]]; then
    echo "âŒ Local source not found: $src"; exit 2
  fi
  dest="${dest:-~/Downloads/}"
  echo "ðŸ“¤ Pushing from Termux: $src â†’ $host:$dest"
  ssh "$host" "mkdir -p '$dest'"
  scp -r -C -p "$src" "$host":"$dest"
  echo "âœ… Push complete."
else
  # pull from Mac â†’ Termux
  dest="${dest:-\$HOME/storage/downloads/}"
  echo "ðŸ“¥ Pulling from $host:$src â†’ Termux directory: $dest"
  mkdir -p "$HOME/storage/downloads/"
  scp -r -C -p "$host":"$src" "$dest"
  echo "âœ… Pull complete."
fi

